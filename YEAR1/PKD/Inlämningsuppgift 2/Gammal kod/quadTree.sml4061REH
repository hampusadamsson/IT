(* PROGRAMKONSTRUKTION OCH DATASTRUKTURER
   INLÄMNINGSUPPGIFT 2 
   Förtfarttare: Philip Åkerfeldt
   Datum:
   Inlämning: 1
*)

(* REPRESENTATION CONVENTION: 
   REPRESENTATION INVARIANT:
*)
datatype rectangle = Rect of int * int * int * int


(* REPRESENTATION CONVENTION: 
   REPRESENTATION INVARIANT: ingen
*)
datatype quadTree = EmptyQuadTree |
Qt of rectangle * rectangle list * rectangle list *
quadTree * quadTree * quadTree * quadTree


(* emptyQtree e
TYPE: rectrangle -> quadTree 
PRE:
POST: Ett tomt quadträd med ytan e 
EXAMPLE:
VARIANT:
*)
fun emptyQtree e = Qt(e, [], [],EmptyQuadTree,EmptyQuadTree,EmptyQuadTree,EmptyQuadTree);  

(* insert (q, r)
TYPE: quadTree * rectangle -> quadTree
PRE: Alla punkter av r finns i quadträdet q.
POST: Quadträdet q med rektangeln r insatt.
EXAMPLE:
VARIANT:
*)


fun insert (Qt(Extent as Rect(eLeft,eTop,eRight, eBottom),H, V, tL, tR, bL, bR), r as Rect(rLeft,rTop,rRight,rBottom))=
    let

	val VA = ((eLeft + eRight) div 2)
	val HA = ((eTop + eBottom) div 2)

    in

	if rLeft <= VA andalso rRight > VA then
	    Qt(Extent, H, r::V, tL, tR, bL, bR)
	else if rBottom <= HA andalso rTop > HA then
	    Qt(Extent, r::H,V, tL, tR, bL, bR)
	else if rRight < VA andalso rBottom > HA then
	    if  tL = EmptyQuadTree then
		Qt(Extent, H, V, insert(emptyQtree (Rect(eLeft, eTop, VA, HA)), r), tR, bL, bR)
	    else
		Qt(Extent, H, V, insert(tL, r), tR, bL, bR)
	else if rLeft > VA andalso rBottom > HA then
	     if tR = EmptyQuadTree then
		 Qt(Extent, H, V, tL, insert(emptyQtree (Rect(VA , eTop, eRight, HA)), r), bL, bR)
	     else
		 Qt(Extent, H, V, tL, insert(tR, r), bL, bR)
	else if rTop < HA andalso rRight < VA then
	     if bL = EmptyQuadTree then
		 Qt(Extent, H, V, tL, tR, insert(emptyQtree (Rect(eLeft, HA, VA, eBottom)), r), bR)
	     else
		 Qt(Extent, H, V, tL, tR, insert(bL, r), bR)
	else if bR = EmptyQuadTree then
		 Qt(Extent, H, V, tL, tR, bL, insert(emptyQtree (Rect(VA, HA, eRight, eBottom)),r))
	     else
		 Qt(Extent, H, V, tL, tR, bL, insert(bR, r))
	
end;
  
   
(* query' (l,x,y)
TYPE: rectangle list*int*int->rectangle list
PRE:
POST:  En lista med de rektanglar i l som har punkten (x,y) i sig.
EXAMPLE:
VARIANT:
*)
fun query' ([],x,y) = [] 
 |  query' (Rect(l,t,r,b)::rest, x,y)=  
    if x >= l andalso x < r andalso y >= b andalso y < t then
        Rect(l,t,r,b):: query'(rest,x,y)
    else
        query'(rest,x,y);
   

 

(* query (q, x, y)
TYPE:
PRE:
POST: Lista av rektanglarna med koordinaterna x och y från quadträdet q.  
EXAMPLE:
VARIANT:

fun query (Qt(Extent,H,V,tL,tR,bL,bR),x,y) =   
*)

